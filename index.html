<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI to Lua Converter</title>
</head>
<body>
    <h1>MIDI to Lua Converter</h1>
    <input type="file" id="midiUpload" accept=".mid">
    <button id="convertButton">Convert to Lua</button>
    <pre id="output"></pre>

    <script type="module">
        import { Midi } from "@tonejs/midi";

        document.getElementById("convertButton").addEventListener("click", async () => {
            let file = document.getElementById("midiUpload").files[0];
            if (!file) {
                alert("Please upload a .mid file first!");
                return;
            }

            const reader = new FileReader();
            reader.onload = async function(event) {
                const arrayBuffer = event.target.result;
                const midi = new Midi(arrayBuffer);
                
                let luaScript = `-- Generated by MIDI2LUA --\n-- MIDI88: OFF --\n-- Short Notes: ON --\n-- Note Velocity: OFF --\n\nbpm = 180\n\n`;
                luaScript += `loadstring(game:HttpGet("https://raw.githubusercontent.com/hellohellohell012321/TALENTLESS/main/loader_main.lua", true))()\n\n`;

                const keyMap = {
                    60: "y", 62: "E", 64: "w", 67: "9", 72: "Y" // Custom MIDI mappings
                };

                midi.tracks.forEach(track => {
                    track.notes.forEach(note => {
                        let key = keyMap[note.midi] || "unknown";
                        if (key !== "unknown") {
                            luaScript += `keypress("${key}", x, bpm)\n`;
                        }
                    });
                });

                luaScript += "finishedSong()";
                document.getElementById("output").textContent = luaScript;
            };

            reader.readAsArrayBuffer(file);
        });
    </script>
    <script src="https://unpkg.com/@tonejs/midi"></script>
</body>
</html>
